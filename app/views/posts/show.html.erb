<div class="post-detail">
  <!-- 投稿タイトル -->
  <h1 class="post-title"><%= @post.title %></h1>

  <!-- 投稿内容 -->
  <p class="post-content"><%= @post.content %></p>

  <!-- 投稿者情報 -->
  <p class="post-author">
    投稿者: <%= link_to @post.user.name, user_path(@post.user) %>
  </p>


  <!-- 投稿画像（添付されている場合のみ表示） -->
  <% if @post.image.attached? %>
  <div class="post-image">
    <%= image_tag @post.image.variant(resize: "200x200"), class: "img-fluid", alt: @post.title %>
  </div>
<% end %>

  
  <!-- いいね機能 -->
  <div class="like-section">
  <% if @post.liked_users.include?(current_user) %>
    <%= button_to 'いいね解除', post_like_path(@post), method: :delete, class: 'btn btn-danger' %>
  <% else %>
    <%= button_to 'いいね', post_like_path(@post), method: :post, class: 'btn btn-primary' %>
  <% end %>
</div>
<p>いいね数: <%= @post.likes.count %></p>

  <h3>コメント一覧</h3>
<% @post.comments.each do |comment| %>
  <div>
    <strong><%= comment.user.name %></strong>: 
    <%= comment.content %>
    <% if comment.user == current_user %>
      <%= link_to "削除", post_comment_path(@post, comment), method: :delete, data: { confirm: "本当に削除しますか？" } %>
    <% end %>
  </div>
<% end %>

<h3>コメントを投稿する</h3>
<%= form_with model: [@post, @post.comments.new], local: true do |form| %>
  <div>
    <%= form.text_area :content, placeholder: "コメントを入力してください" %>
  </div>
  <div>
    <%= form.submit "投稿" %>
  </div>
<% end %>

<!-- 投稿者をフォローするセクション -->
<div class="follow-section mt-3">
  <% if @post.user != current_user %> <!-- 自分自身はフォロー不可 -->
    <% if current_user.following?(@post.user) %>
      <%= button_to 'フォロー解除', relationship_path(@post.user), method: :delete, class: 'btn btn-danger' %>
    <% else %>
      <%= button_to 'フォローする', relationships_path(followed_id: @post.user.id), method: :post, class: 'btn btn-primary' %>
    <% end %>
  <% end %>
</div>


  <!-- アクションボタン -->
  <div class="post-actions mt-3">
    <%= link_to '編集', edit_post_path(@post), class: 'btn btn-warning me-2' %>
    <%= link_to '削除', post_path(@post), method: :delete, data: { confirm: '本当に削除しますか？' }, class: 'btn btn-danger me-2' %>
    <%= link_to '戻る', posts_path, class: 'btn btn-secondary' %>
  </div>
</div>
